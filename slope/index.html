<!DOCTYPE html>
<html>
<head>
    <title>Visual Vocabulary</title>
    <script src="/shared/d3.v4.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
    <script src="/shared/js/g-chartframe.js"></script>
    <link rel="stylesheet" href="https://build.origami.ft.com/v2/bundles/css?modules=o-fonts@^2.2.0" />
</head>
<body>

    <h1>Slope chart</h1>
    <p>Good for showing changing data as long as the data can be simplified into 2 or 3 points without missing a key part of story</p>
    <hr>
    <figure class="web"><svg></svg></figure>
    <figure class="print"><svg></svg></figure>
    <figure class="social"><svg></svg></figure>
    <figure class="video"><svg></svg></figure>

</body>

<script type="text/javascript">

    const webframe = gChartframe.webFrame;

    d3.select('.web svg')
        .call(webframe);

    d3.csv('data.csv',function(data){
        const valueColumns = ['val1','val2'];

        const valueScale = d3.scaleLinear()
            .domain(extentMulti(data,valueColumns))
            .range([0, webframe.dimension().height]);

        const timeScale = d3.scaleOrdinal()
            .domain(valueColumns)
            .range([0, webframe.dimension().width]);

        webframe.plot()
            .selectAll('g.slope')
            .data(data)
            .enter()
            .append('g').attr('class','slope')
            .call((parent)=>{
                parent.append('line')
                    .attrs({
                        'x1':timeScale(valueColumns[0]),
                        'x2':timeScale(valueColumns[1]),
                        'y1':d=>valueScale(d[valueColumns[0]]),
                        'y2':d=>valueScale(d[valueColumns[1]]),
                        'stroke':'#000',
                        'stroke-opacity':0.2
                    });

//start circle...
                parent.append('circle')
                    .attrs({
                        'cx':timeScale(valueColumns[0]),
                        'cy':d=>valueScale(d[valueColumns[0]]),
                        'r':5,
                    })
//end circle...
                parent.append('circle')
                    .attrs({
                        'cx':timeScale(valueColumns[1]),
                        'cy':d=>valueScale(d[valueColumns[1]]),
                        'r':5,
                    })

            });
    });



//a function to work out the extent of values in an array accross multiple properties...
    function extentMulti(data, columns){
        const ext = data.reduce((acc, row, index)=>{
            let values = columns.map(key=>row[key])
            let rowExtent = d3.extent(values);
            if(!acc.max){
                acc.max = rowExtent[1];
                acc.min = rowExtent[0];
            }else{
                acc.max = Math.max(acc.max, rowExtent[1]);
                acc.min = Math.min(acc.min, rowExtent[0]);
            }
            return acc;
        },{})
        return [ext.min, ext.max];
    }

</script>
</html>