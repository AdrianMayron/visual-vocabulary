<html>
<head>
	<title>treemap</title>
	<script type="text/javascript" src="../d3/d3.v3.min.js"></script>
	<style type="text/css">

	</style>
</head>

<body>
	<h1>Treemap</h1>
	<!-- <a href="https://github.com/ft-interactive/graphics-examples/tree/master/open-close-high-low">source</a> -->

	<div class="chart">
	</div>
	<div class="key">
	</div>
</body>

<script type="text/javascript">
//styling
var styles = {
    'text': {
        'font-family': 'Metric, sans-serif'
    },
	'.y.axis .domain, .x.axis .domain': {
		'fill': 'none',
		'stroke': '#a7a59b'
	},
	'.y.axis .domain': {
		'stroke': 'none'
	},
	'.y.axis .tick line, .x.axis .tick line': {
		'fill': 'none',
		'stroke': '#cec6b9'
	},
	'.y.axis .tick text, .x.axis .tick text': {
		'fill': '#74736c',
		'font-size': '14'
	},
	'.y.axis .tick text': {
		'text-anchor': 'end'
	},
	'.x.axis .tick text': {
		'text-anchor': 'middle'
	},
	'.day line': {
		'stroke-width': '2',
		'shape-rendering': 'crispEdges'
	}
};

//Configuration
var data = 'tremap-data.csv',	//The spreadsheet where the data comes from
	chartWidth = 600,
	chartHeight = 500,
	margin = { top:100, bottom:50, left:40, right:25 },
	plotWidth = chartWidth - (margin.left + margin.right),
	plotHeight = chartHeight - (margin.top + margin.bottom);

//Load the data, when it's loaded draw the chart
d3.csv(data, drawChart);

function drawChart(loadedData){
	var dataset=loadedData//assigns the dataset name to the loaded data, as this is what I'm mostly used to with working with. var name could be anythiung.
	console.log("dataset before nest function",dataset)//shows the data its parsed csv format

}


function nest(data) {
	return {
		"key":"Groups", 
		"values":d3.nest()
			.key(function (d) { return d.group})
			//.key(function (d) { return d.value})
			.entries(data)
	};
}

function drawTreemap(data){
	d3.select("#main").html("Use crowbar to save your svg")
	var margin = {top: 0, right: 0, bottom: 0, left: 0};
    svgWidth = (svgWidth) - margin.left - margin.right;
    svgHeight = (svgHeight) - margin.top - margin.bottom;

    var color = d3.scale.ordinal()
      .range(["#004C6C","#007BA8","#64A2C1","#95BFC5","#C6D6CC","#D9E7EF","#DDB831"]);

    var treemap = d3.layout.treemap()
	    .size([svgWidth, svgHeight])
	    .sticky(true)
	    .sort(function(a, b) { return a.value - b.value; })
	    .value(function(d) { 
	    	return d.value; })
	    .children(function(d){
	    	return d.values;
	    });
	var treeData = treemap(data);

    var svg = d3.select("#main")
    	.append("svg")
    		.attr("width",svgWidth - margin.left - margin.right)
	    	.attr("height", svgHeight - margin.top - margin.bottom)
    	.append('g')
    		.attr({
    			transform: 'translate(' + margin.left + ',' + margin.top + ')'
    		});

    var node = svg
    	.selectAll(".node")
		.data(treeData)
			.enter()
		.append("g")
			.attr({
				"class": "node",
				transform: function(d){ 
					return 'translate('+d.x+','+(d.y+10)+')'
				}
			})
		.call(function(parent){
			parent.append('rect')
				.attr("x",0-7)
				.attr("y",0-12)
				.attr("width",function(d){ return d.dx })
				.attr("height",function(d){ return d.dy })
				.style("stroke", "white")
				.style("fill",function(d){
					if(d.children){
						return "none"
					}
					else {return color(d.group)}
				})

			parent.append('text')
				.text(function(d){
					return d.item +" "+d.value;
				})
		})
			
}

function drawKey(data){
	var legend=data.children.filter(function(el){return el.key});
	console.log(legend)
	var color = d3.scale.ordinal()
      .range(["#004C6C","#007BA8","#64A2C1","#95BFC5","#C6D6CC","#D9E7EF","#DDB831"]);
	var key=d3.select("#main").append("svg")
	key.selectAll('rect')
		.data(legend)
		.enter()
			.append("g")
			.call(function(parent){
				parent.append('rect')
				.attr("width",12)
				.attr("height",8)
				.attr("x",10)
				.attr("y",function(d,i){return i*12})
				.style("fill",function(d){return color(d.key)})

				parent.append('text')
					.attr("x",24)
					.attr("y",function(d,i){return i*12+8})
					.attr("class","node")
					.text(function(d){
						return d.key
					})
			})


}







</script>
 
</body>

