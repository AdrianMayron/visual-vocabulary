<!DOCTYPE html>
<html>
<head>
    <title>Scatter chart - Visual Vocabulary</title>
    <script src="//d3js.org/d3.v4.js"></script>
    <script src="//d3js.org/d3-selection-multi.v1.min.js"></script>
    <script src="//financial-times.github.io/g-chartframe/build/g-chartframe.js"></script>
    <script src="simple-statistics.min.js"></script>
    <script src="//ft-interactive.github.io/visual-vocabulary/shared/svg2png.js"></script>
    <script src="//ft-interactive.github.io/g-chartcolour/build/g-chartcolour.js"></script>
    <script src="scatter.js"></script>
    <link rel="stylesheet" href="https://www.ft.com/__origami/service/build/v2/bundles/css?modules=o-fonts@^2.2.0" />
    <link rel="stylesheet" src="style.css"/>
    <style>
    .saveable button{ display: block; }
    </style>
</head>
<body>

    <h1>Scatter chart</h1>
    <p>The standard way to show the relationship between two continuous variables, each of which has its own axis.</p>
    <hr>
    <figure class="framed saveable" data-frame="web"><svg></svg></figure>
    <figure class="framed saveable" data-frame="print"><svg></svg></figure>
    <figure class="framed saveable" data-frame="social"><svg></svg></figure>
    <figure class="framed saveable" data-frame="video"><svg></svg></figure>

</body>

<script type="text/javascript">

const valueColumns = ['x','y'];    //the names of the columns in the data file to be plotter, x axis followed by y axis

const frame = {
    web: gChartframe.webFrame()
        .width(700)
        .margin({left:75,right:50,top:60,bottom:50})
        .title("Anscombe's quartet in a single chart")
        .subtitle("Each series is a different colour (no key just yet)")
        .source("FT graphic Alan Smith|Source: FT research"),

    print: gChartframe.printFrame()
        .margin({top:60,left:20,right:20})
        .height(190),   //note, this value is in mm for the print frame

    social: gChartframe.socialFrame()
        .margin({left:100,right:100})
        .title('Slightly shorter title perhaps?'),

    video: gChartframe.videoFrame(),
};

d3.selectAll('.framed')
    .each(function(){
        const figure = d3.select(this);
        figure.select('svg')
            .call(frame[figure.node().dataset.frame]);
    });


const dataSorter = function(a,b){    //Sort the data so that the labeled items are drawn on top
    if(a.label === 'yes') return 1;
    return -1;
};


d3.csv('anscombe.csv',function(data){

    //coerce the axes data into numbers
    data.forEach(function(d){
        d[valueColumns[0]]=+d[valueColumns[0]]
        d[valueColumns[1]]=+d[valueColumns[1]]
    })

    //identify groups in the data
    var groups = d3.set(data, function(d) { return d.group; }).values();

    //calculate extents
    const xExtent = d3.extent(data, function(d){
        return d[valueColumns[0]]
    })
    const yExtent = d3.extent(data, function(d){
        return d[valueColumns[1]]
    }).reverse()

    data.sort(dataSorter);

    const valueFormat = d=>d3.format(',')(d)

    //General chart configuration
    const myScatter = scatterChart()
        .colourProperty( 'label' )  //the data property determining the lines colour
        .colourDomain( ['','yes'] )
        .groups(groups) //the values of that property corresponding to the colours in the basic chart colour scheme
        .xDomain( xExtent ) 
        .yDomain( yExtent )
        .includeLabel( (row)=> (row.label === 'yes') )

    
    //general axes configuration    
    const myAxes = scatterAxes()
        //.yTicks([4,5,9,12])
        

    //specific scatter configuration
    Object.keys(frame).forEach(frameName=>{
        const currentFrame = frame[frameName];

        myScatter.xRange( [0, currentFrame.dimension().width] )
            .yRange( [0, currentFrame.dimension().height-10] );//offset on height to cope with x axis being under chart

        myAxes.xScale( myScatter.xScale() )
            .yScale( myScatter.yScale() );
            
        // specifics based on frame type
        myScatter.colourInverse((frameName === 'social' || frameName === 'video'));
        myAxes.colourInverse((frameName === 'social' || frameName === 'video'));

        //do the actual drawing...

        currentFrame.plot()
            .selectAll( 'g.scatter' )
            .data( data )
            .enter()
            .append( 'g' )
                .attr('class','scatter')
            .call(myScatter);

        currentFrame.plot()
            .call( myAxes );
    });

    addSVGSavers('figure.saveable');
    
});


</script>
</html>